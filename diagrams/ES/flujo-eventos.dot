digraph FlujoEventos {
    rankdir=TB;
    
    graph [
        fontname="Arial, sans-serif"
        fontsize=12
        bgcolor="#fafafa"
        style=filled
        pad=0.5
        nodesep=0.8
        ranksep=1.2
    ];
    
    node [
        fontname="Arial, sans-serif"
        fontsize=10
        style=filled
        shape=box
        margin=0.1
    ];
    
    edge [
        fontname="Arial, sans-serif"
        fontsize=9
        color="#666666"
    ];

    // Eventos de Dominio
    subgraph cluster_events {
        label="ğŸ“¡ EVENTOS DE DOMINIO";
        style=filled;
        fillcolor="#fff3e0";
        color="#f57c00";
        fontcolor="#f57c00";
        fontsize=14;
        
        ProductoCreado [
            label="ğŸ‰ ProductoCreado\nâ€¢ idProducto\nâ€¢ nombreProducto\nâ€¢ precio\nâ€¢ marcaTiempo"
            fillcolor="#ffb74d"
            shape=ellipse
        ];
        
        ProductoActualizado [
            label="ğŸ“ ProductoActualizado\nâ€¢ idProducto\nâ€¢ cambios\nâ€¢ marcaTiempo"
            fillcolor="#ffb74d"
            shape=ellipse
        ];
        
        StockCambiado [
            label="ğŸ“¦ StockCambiado\nâ€¢ idProducto\nâ€¢ stockAnterior\nâ€¢ stockNuevo\nâ€¢ tipoCambio\nâ€¢ marcaTiempo"
            fillcolor="#ffb74d"
            shape=ellipse
        ];
        
        UsuarioCreado [
            label="ğŸ‘¤ UsuarioCreado\nâ€¢ idUsuario\nâ€¢ nombreUsuario\nâ€¢ email\nâ€¢ marcaTiempo"
            fillcolor="#ffb74d"
            shape=ellipse
        ];
        
        UsuarioActivado [
            label="âœ… UsuarioActivado\nâ€¢ idUsuario\nâ€¢ marcaTiempo"
            fillcolor="#ffb74d"
            shape=ellipse
        ];
    }

    // Bus de Eventos
    BusEventos [
        label="ğŸšŒ BusEventos\n(BusEventosEnMemoria)\n\nâ€¢ publicar(evento)\nâ€¢ suscribir(nombreEvento, manejador)\nâ€¢ manejadores: Map<string, Manejador[]>\nâ€¢ procesamiento asÃ­ncrono"
        fillcolor="#ff9800"
        color="#f57c00"
        fontsize=11
        shape=doubleoctagon
    ];

    // Manejadores de Eventos
    subgraph cluster_handlers {
        label="ğŸ“¬ MANEJADORES DE EVENTOS\n(Procesamiento AsÃ­ncrono)";
        style=filled;
        fillcolor="#e8f5e8";
        color="#388e3c";
        fontcolor="#388e3c";
        fontsize=14;
        
        ManejadorNotificacion [
            label="ğŸ“§ ManejadorNotificaciÃ³n\nâ€¢ Enviar notificaciones por email\nâ€¢ Notificaciones push\nâ€¢ Alertas SMS\nâ€¢ Llamadas webhook"
            fillcolor="#a5d6a7"
        ];
        
        ManejadorAuditoria [
            label="ğŸ“‹ ManejadorAuditorÃ­a\nâ€¢ Registrar todos los eventos\nâ€¢ Crear pista de auditorÃ­a\nâ€¢ Seguimiento de cumplimiento\nâ€¢ Registros histÃ³ricos"
            fillcolor="#a5d6a7"
        ];
        
        ManejadorAnalÃ­ticas [
            label="ğŸ“Š ManejadorAnalÃ­ticas\nâ€¢ Actualizar estadÃ­sticas\nâ€¢ Generar reportes\nâ€¢ Rastrear KPIs\nâ€¢ MÃ©tricas de negocio"
            fillcolor="#a5d6a7"
        ];
        
        ManejadorCache [
            label="ğŸ’¾ ManejadorCache\nâ€¢ Invalidar datos en cachÃ©\nâ€¢ Actualizar entradas de cache\nâ€¢ Refrescar Ã­ndices de bÃºsqueda\nâ€¢ Limpiar cache relacionado"
            fillcolor="#a5d6a7"
        ];
        
        ManejadorIntegracion [
            label="ğŸ”— ManejadorIntegraciÃ³n\nâ€¢ Sincronizar con sistemas externos\nâ€¢ IntegraciÃ³n ERP\nâ€¢ APIs de terceros\nâ€¢ SincronizaciÃ³n de datos"
            fillcolor="#a5d6a7"
        ];
    }

    // Casos de Uso (Publicadores de Eventos)
    subgraph cluster_publishers {
        label="ğŸ¢ PUBLICADORES DE EVENTOS\n(Casos de Uso)";
        style=filled;
        fillcolor="#e3f2fd";
        color="#1976d2";
        fontcolor="#1976d2";
        fontsize=14;
        
        CasoUsoCrearProducto [
            label="âš™ï¸ CrearProducto\nCaso de Uso\npublicar(ProductoCreado)"
            fillcolor="#90caf9"
        ];
        
        CasoUsoActualizarProducto [
            label="âš™ï¸ ActualizarProducto\nCaso de Uso\npublicar(ProductoActualizado)"
            fillcolor="#90caf9"
        ];
        
        CasoUsoAumentarStock [
            label="âš™ï¸ AumentarStock\nCaso de Uso\npublicar(StockCambiado)"
            fillcolor="#90caf9"
        ];
        
        CasoUsoCrearUsuario [
            label="âš™ï¸ CrearUsuario\nCaso de Uso\npublicar(UsuarioCreado)"
            fillcolor="#90caf9"
        ];
    }

    // Sistemas Externos
    subgraph cluster_external {
        label="ğŸŒ SISTEMAS EXTERNOS";
        style=filled;
        fillcolor="#f3e5f5";
        color="#7b1fa2";
        fontcolor="#7b1fa2";
        fontsize=14;
        
        ServicioEmail [
            label="ğŸ“¬ Servicio Email\n(SendGrid/AWS SES)"
            fillcolor="#ce93d8"
            shape=cylinder
        ];
        
        BaseDatosAuditoria [
            label="ğŸ“Š Base Datos AuditorÃ­a\n(AlmacÃ©n de Eventos)"
            fillcolor="#ce93d8"
            shape=cylinder
        ];
        
        PlataformaAnalÃ­ticas [
            label="ğŸ“ˆ Plataforma AnalÃ­ticas\n(Google Analytics/Mixpanel)"
            fillcolor="#ce93d8"
            shape=cylinder
        ];
        
        SistemaCache [
            label="ğŸ’¾ Sistema Cache\n(Redis/Memcached)"
            fillcolor="#ce93d8"
            shape=cylinder
        ];
        
        SistemaERP [
            label="ğŸ­ Sistema ERP\n(SAP/Oracle)"
            fillcolor="#ce93d8"
            shape=cylinder
        ];
    }

    // Flujo: Casos de Uso -> Eventos
    CasoUsoCrearProducto -> ProductoCreado [label="emite" color="#2196f3"];
    CasoUsoActualizarProducto -> ProductoActualizado [label="emite" color="#2196f3"];
    CasoUsoAumentarStock -> StockCambiado [label="emite" color="#2196f3"];
    CasoUsoCrearUsuario -> UsuarioCreado [label="emite" color="#2196f3"];

    // Flujo: Eventos -> BusEventos
    ProductoCreado -> BusEventos [label="publicar" color="#ff9800"];
    ProductoActualizado -> BusEventos [label="publicar" color="#ff9800"];
    StockCambiado -> BusEventos [label="publicar" color="#ff9800"];
    UsuarioCreado -> BusEventos [label="publicar" color="#ff9800"];
    UsuarioActivado -> BusEventos [label="publicar" color="#ff9800"];

    // Flujo: BusEventos -> Manejadores
    BusEventos -> ManejadorNotificacion [label="notificar asÃ­nc." color="#4caf50" style=dashed];
    BusEventos -> ManejadorAuditoria [label="registrar asÃ­nc." color="#4caf50" style=dashed];
    BusEventos -> ManejadorAnalÃ­ticas [label="rastrear asÃ­nc." color="#4caf50" style=dashed];
    BusEventos -> ManejadorCache [label="invalidar asÃ­nc." color="#4caf50" style=dashed];
    BusEventos -> ManejadorIntegracion [label="sincronizar asÃ­nc." color="#4caf50" style=dashed];

    // Flujo: Manejadores -> Sistemas Externos
    ManejadorNotificacion -> ServicioEmail [label="enviar emails" color="#9c27b0"];
    ManejadorAuditoria -> BaseDatosAuditoria [label="almacenar eventos" color="#9c27b0"];
    ManejadorAnalÃ­ticas -> PlataformaAnalÃ­ticas [label="rastrear mÃ©tricas" color="#9c27b0"];
    ManejadorCache -> SistemaCache [label="actualizar cache" color="#9c27b0"];
    ManejadorIntegracion -> SistemaERP [label="sincronizar datos" color="#9c27b0"];

    // Suscripciones de Eventos (registro)
    subgraph cluster_subscriptions {
        label="ğŸ”” SUSCRIPCIONES DE EVENTOS\n(Registro de Manejadores)";
        style=filled;
        fillcolor="#fff8e1";
        color="#ffa000";
        fontcolor="#ffa000";
        fontsize=12;
        
        Suscripciones [
            label="ğŸ“‹ Suscripciones de Eventos\n\nproducto.creado:\n  â†’ ManejadorNotificaciÃ³n\n  â†’ ManejadorAuditorÃ­a\n  â†’ ManejadorAnalÃ­ticas\n\nproducto.actualizado:\n  â†’ ManejadorAuditorÃ­a\n  â†’ ManejadorCache\n\nstock.cambiado:\n  â†’ ManejadorNotificaciÃ³n\n  â†’ ManejadorAnalÃ­ticas\n  â†’ ManejadorIntegraciÃ³n\n\nusuario.creado:\n  â†’ ManejadorNotificaciÃ³n\n  â†’ ManejadorAuditorÃ­a"
            fillcolor="#ffecb3"
            shape=note
        ];
    }

    // Patrones de Flujo de Eventos
    subgraph cluster_patterns {
        label="ğŸ”„ PATRONES DE EVENTOS";
        style=filled;
        fillcolor="#e8eaf6";
        color="#3f51b5";
        fontcolor="#3f51b5";
        fontsize=12;
        
        Patrones [
            label="ğŸ“ Patrones Comunes\n\nğŸ”„ Publicar-Suscribir\nâ€¢ Acoplamiento dÃ©bil\nâ€¢ Procesamiento asÃ­ncrono\n\nâš¡ Abastecimiento de Eventos\nâ€¢ Historial completo de eventos\nâ€¢ Pista de auditorÃ­a\n\nğŸ¯ Preparado para CQRS\nâ€¢ SeparaciÃ³n Comando/Consulta\nâ€¢ Actualizaciones dirigidas por eventos\n\nğŸ”— PatrÃ³n Saga\nâ€¢ Transacciones distribuidas\nâ€¢ Acciones de compensaciÃ³n"
            fillcolor="#c5cae9"
            shape=note
        ];
    }

    // Caja de beneficios
    Beneficios [
        label="âœ¨ BENEFICIOS\n\nğŸ”’ Desacoplamiento\nâ€¢ Manejadores independientes\nâ€¢ Sin dependencias directas\n\nâš¡ Escalabilidad\nâ€¢ Procesamiento asÃ­ncrono\nâ€¢ Escalado horizontal\n\nğŸ”„ Extensibilidad\nâ€¢ FÃ¡cil agregar manejadores\nâ€¢ Arquitectura de plugins\n\nğŸ“Š Observabilidad\nâ€¢ Seguimiento de eventos\nâ€¢ Monitoreo del sistema"
        fillcolor="#e8f5e8"
        color="#4caf50"
        shape=note
    ];

    // TÃ­tulo
    labelloc="t";
    label=<<B>Eventos de Dominio &amp; ComunicaciÃ³n AsÃ­ncrona</B><BR/>
    <I>Arquitectura Dirigida por Eventos con PatrÃ³n BusEventos</I><BR/>
    <FONT POINT-SIZE="10">Acoplamiento dÃ©bil a travÃ©s de eventos de dominio y procesamiento asÃ­ncrono</FONT>>;
    fontsize=16;
}
